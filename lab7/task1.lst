SQL> SET ECHO ON
SQL> SET FEEDBACK ON
SQL> SET LINESIZE 100
SQL> SET PAGESIZE 100
SQL> SET SERVEROUTPUT ON
SQL> CREATE OR REPLACE PROCEDURE LISTSKILL
IS
	aNum APPLICANT.ANUMBER%TYPE;
	firstname APPLICANT.FNAME%TYPE;
	lastname APPLICANT.LNAME%TYPE;
	skname SPOSSESSED.SNAME%TYPE;
	sklevel SPOSSESSED.SLEVEL%TYPE;

	CURSOR Q1 IS
		SELECT ANUMBER, FNAME, LNAME FROM APPLICANT;
	CURSOR Q2 IS
		SELECT SNAME, SLEVEL FROM SPOSSESSED WHERE ANUMBER = aNum ORDER BY SLEVEL DESC;

	cnt NUMBER;
	output VARCHAR(400);

BEGIN

	OPEN Q1;
	LOOP
		FETCH Q1 INTO aNum, firstname, lastname;
		IF Q1%NOTFOUND THEN EXIT; END IF;

		OPEN Q2;
		cnt := 0;
		output := '';
		LOOP
			FETCH Q2 INTO skname, sklevel;
			IF Q2%NOTFOUND THEN EXIT; END IF;

			cnt := cnt + 1;
			output := output || UPPER(skname) || ':' || sklevel || ', ';
		END LOOP;
		CLOSE Q2;
    
    IF cnt>1 THEN
		DBMS_OUTPUT.PUT_LINE('Skill Count: ' || cnt || ', ' || UPPER(firstname) || ' ' || UPPER(lastname) || ': ' || output);
    END IF;
	END LOOP;
	CLOSE Q1;
END LISTSKILL;
/

Procedure LISTSKILL compiled

SQL> EXECUTE LISTSKILL;

PL/SQL procedure successfully completed.

Skill Count: 3, HARRY POTTER: JAVA PROGRAMMING:9, COOKING:9, C PROGRAMMING:4, 
Skill Count: 2, JOHNNY WALKER: DRIVING:9, JAVA PROGRAMMING:9, 
Skill Count: 3, MARY POPPINS: C++ PROGRAMMING:10, JAVA PROGRAMMING:9, PAINTING:5, 
Skill Count: 2, JAMES BOND: COOKING:10, SQL PROGRAMMING:9, 
Skill Count: 2, STEPHEN STAUNTON: COOKING:9, SQL PROGRAMMING:3, 
Skill Count: 4, JOHN SPIDERMAN: SQL PROGRAMMING:10, DATABASE DESIGN:10, PAINTING:9, COOKING:1, 
Skill Count: 2, GEORGE THEFIRST: NETWORK ADMINISTRATION:10, C PROGRAMMING:5, 
Skill Count: 3, HOMER SIMPSON: JAVA PROGRAMMING:9, DRIVING:3, COOKING:1, 
Skill Count: 2, NEIL SUPERMAN: NETWORK ADMINISTRATION:7, DATABASE ADMINISTRATION:6, 
Skill Count: 2, RICHARD THELIONHEART: COOKING:9, DATABASE ADMINISTRATION:7, 
Skill Count: 4, SHERLOCK HOLMES: DATABASE DESIGN:9, BRICKLAYING:6, NETWORK ADMINISTRATION:5, DATABASE ADMINISTRATION:3, 

SQL> SPOOL OFF;
